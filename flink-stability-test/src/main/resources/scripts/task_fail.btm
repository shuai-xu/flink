##############################################################################
#
# @authors niwan@taobao.com
#
# Test blink stability when task fail

#
RULE Task run()'s entry fail
CLASS org.apache.flink.runtime.taskmanager.Task
METHOD run()
HELPER com.alibaba.blink.stabilitytest.STCaseHelper
AT ENTRY
COMPILE
BIND runnable = $0;
IF TRUE
DO
    invokeSTMethod("org.apache.flink.runtime.taskmanager.TaskFailSTCase", "entryExitFail", new Object[]{runnable, $CLASS, $METHOD, "AT ENTRY"});
ENDRULE

#
RULE Task run()'s exit fail
CLASS org.apache.flink.runtime.taskmanager.Task
METHOD run()
HELPER com.alibaba.blink.stabilitytest.STCaseHelper
AT EXIT
COMPILE
BIND runnable = $0;
IF TRUE
DO
    invokeSTMethod("org.apache.flink.runtime.taskmanager.TaskFailSTCase", "entryExitFail", new Object[]{runnable, $CLASS, $METHOD, "AT EXIT"});
ENDRULE

#
RULE Task run()'s running fail
CLASS org.apache.flink.runtime.taskmanager.Task
METHOD run()
HELPER com.alibaba.blink.stabilitytest.STCaseHelper
AT LINE -1
COMPILE
BIND runnable = $0;
IF TRUE
DO
    invokeSTMethod("org.apache.flink.runtime.taskmanager.TaskFailSTCase", "runningFail", new Object[]{runnable, $CLASS, $METHOD, new Integer(-1)});
ENDRULE

# For call StreamTask or BatchTask invoke()
RULE AbstractInvokable invoke()'s running fail
CLASS ^org.apache.flink.runtime.jobgraph.tasks.AbstractInvokable
METHOD invoke()
HELPER com.alibaba.blink.stabilitytest.STCaseHelper
AT LINE -1
COMPILE
BIND runnable = $0;
IF TRUE
DO
    invokeSTMethod("org.apache.flink.runtime.taskmanager.TaskFailSTCase", "runningFail", new Object[]{runnable, $CLASS, $METHOD, new Integer(-1)});
ENDRULE

#
RULE StreamTask run()'s running fail
CLASS ^org.apache.flink.streaming.runtime.tasks.StreamTask
METHOD run()
HELPER com.alibaba.blink.stabilitytest.STCaseHelper
AT LINE -1
COMPILE
BIND runnable = $0;
IF TRUE
DO
    invokeSTMethod("org.apache.flink.runtime.taskmanager.TaskFailSTCase", "runningFail", new Object[]{runnable, $CLASS, $METHOD, new Integer(-1)});
ENDRULE

#
RULE BatchTask run()'s running fail
CLASS ^org.apache.flink.runtime.operators.BatchTask
METHOD run()
HELPER com.alibaba.blink.stabilitytest.STCaseHelper
AT LINE -1
COMPILE
BIND runnable = $0;
IF TRUE
DO
    invokeSTMethod("org.apache.flink.runtime.taskmanager.TaskFailSTCase", "runningFail", new Object[]{runnable, $CLASS, $METHOD, new Integer(-1)});
ENDRULE
